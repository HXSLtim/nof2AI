# ğŸ—ï¸ ç³»ç»Ÿæ¶æ„æ–‡æ¡£

## ğŸ“‹ æ¦‚è¿°

nof2AI æ˜¯ä¸€ä¸ªåŸºäºäººå·¥æ™ºèƒ½çš„é‡åŒ–äº¤æ˜“ç³»ç»Ÿï¼Œé‡‡ç”¨ç°ä»£åŒ–çš„å¾®æœåŠ¡æ¶æ„è®¾è®¡ï¼Œæ”¯æŒå¤šAIæœåŠ¡é›†æˆã€å®æ—¶æ•°æ®å¤„ç†å’Œæ™ºèƒ½äº¤æ˜“å†³ç­–ã€‚æœ¬æ–‡æ¡£è¯¦ç»†æè¿°äº†ç³»ç»Ÿçš„æ•´ä½“æ¶æ„ã€æ ¸å¿ƒç»„ä»¶å’ŒæŠ€æœ¯å®ç°ã€‚

---

## ğŸ¯ æ¶æ„åŸåˆ™

### ğŸ’¡ è®¾è®¡ç†å¿µ

#### 1. æ¨¡å—åŒ–è®¾è®¡
- **é«˜å†…èš**ï¼šæ¯ä¸ªæ¨¡å—ä¸“æ³¨äºå•ä¸€èŒè´£
- **ä½è€¦åˆ**ï¼šæ¨¡å—é—´ä¾èµ–æœ€å°åŒ–
- **å¯æ‰©å±•**ï¼šæ”¯æŒæ°´å¹³æ‰©å±•å’ŒåŠŸèƒ½æ‰©å±•
- **å¯æµ‹è¯•**ï¼šæ˜“äºå•å…ƒæµ‹è¯•å’Œé›†æˆæµ‹è¯•

#### 2. å¯é æ€§ä¼˜å…ˆ
- **å®¹é”™æœºåˆ¶**ï¼šå…³é”®è·¯å¾„æœ‰é™çº§æ–¹æ¡ˆ
- **å¹‚ç­‰æ€§**ï¼šé‡å¤æ“ä½œä¸äº§ç”Ÿå‰¯ä½œç”¨
- **æ•°æ®ä¸€è‡´æ€§**ï¼šç¡®ä¿æ•°æ®çš„å‡†ç¡®æ€§å’Œä¸€è‡´æ€§
- **ç›‘æ§å‘Šè­¦**ï¼šå®Œå–„çš„ç›‘æ§å’Œå‘Šè­¦ä½“ç³»

#### 3. æ€§èƒ½ä¼˜åŒ–
- **å¼‚æ­¥å¤„ç†**ï¼šéé˜»å¡çš„å¼‚æ­¥æ“ä½œ
- **ç¼“å­˜ç­–ç•¥**ï¼šå¤šçº§ç¼“å­˜æå‡å“åº”é€Ÿåº¦
- **å¹¶å‘å¤„ç†**ï¼šæ”¯æŒé«˜å¹¶å‘è¯·æ±‚
- **èµ„æºä¼˜åŒ–**ï¼šåˆç†åˆ©ç”¨ç³»ç»Ÿèµ„æº

#### 4. å®‰å…¨ä¿éšœ
- **å¤šå±‚é˜²æŠ¤**ï¼šä»ç½‘ç»œåˆ°åº”ç”¨çš„å¤šå±‚å®‰å…¨
- **æƒé™æ§åˆ¶**ï¼šç»†ç²’åº¦çš„æƒé™ç®¡ç†
- **æ•°æ®ä¿æŠ¤**ï¼šæ•æ„Ÿæ•°æ®çš„åŠ å¯†å­˜å‚¨
- **å®¡è®¡æ—¥å¿—**ï¼šå®Œæ•´çš„æ“ä½œå®¡è®¡

---

## ğŸ›ï¸ æ•´ä½“æ¶æ„

### ğŸ“ ç³»ç»Ÿæ¶æ„å›¾

```
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚                         å‰ç«¯å±‚ (Frontend)                        â”‚
â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤
â”‚  React Components (Ant Design) â”‚ Next.js App Router â”‚ TypeScript  â”‚
â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤
â”‚                         APIç½‘å…³å±‚                                â”‚
â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤
â”‚      è®¤è¯æˆæƒ     â”‚     é™æµæ§åˆ¶     â”‚     è¯·æ±‚è·¯ç”±     â”‚ æ—¥å¿—è®°å½•   â”‚
â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤
â”‚                       ä¸šåŠ¡æœåŠ¡å±‚                                â”‚
â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤
â”‚  AIå†³ç­–æœåŠ¡   â”‚  äº¤æ˜“æ‰§è¡ŒæœåŠ¡  â”‚  é£é™©æ§åˆ¶æœåŠ¡  â”‚  æ•°æ®æœåŠ¡      â”‚
â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤
â”‚                       å¤–éƒ¨é›†æˆå±‚                                â”‚
â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤
â”‚   OKXäº¤æ˜“æ‰€   â”‚   AIæœåŠ¡     â”‚   æ•°æ®æº     â”‚   é€šçŸ¥æœåŠ¡        â”‚
â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤
â”‚                       æ•°æ®å­˜å‚¨å±‚                                â”‚
â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤
â”‚   SQLite     â”‚   Redisç¼“å­˜   â”‚   æ–‡ä»¶å­˜å‚¨   â”‚   æ—¥å¿—å­˜å‚¨        â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
```

### ğŸ”„ æ•°æ®æµæ¶æ„

```
å¸‚åœºæ•°æ®æº â†’ æ•°æ®é‡‡é›† â†’ æŠ€æœ¯æŒ‡æ ‡è®¡ç®— â†’ AIå†³ç­–å¼•æ“ â†’ é£é™©æ§åˆ¶ â†’ äº¤æ˜“æ‰§è¡Œ â†’ OKXäº¤æ˜“æ‰€
     â†“           â†“            â†“              â†“            â†“          â†“
   æ•°æ®åº“     å®æ—¶ç¼“å­˜      æŒ‡æ ‡ç¼“å­˜      å†³ç­–å†å²      ä»“ä½ç®¡ç†     è®¢å•è®°å½•
     â†“           â†“            â†“              â†“            â†“          â†“
   æŒä¹…åŒ–     ç¼“å­˜æ›´æ–°      æŒ‡æ ‡å­˜å‚¨      å†³ç­–åˆ†æ      é£é™©ç›‘æ§     æ‰§è¡Œè·Ÿè¸ª
```

---

## ğŸ§© æ ¸å¿ƒç»„ä»¶æ¶æ„

### 1. å‰ç«¯æ¶æ„ (Frontend Architecture)

#### ğŸ“¦ ç»„ä»¶å±‚æ¬¡ç»“æ„
```
src/app/
â”œâ”€â”€ layout.tsx                 # æ ¹å¸ƒå±€
â”œâ”€â”€ page.tsx                   # ä¸»é¡µé¢
â”œâ”€â”€ globals.css                # å…¨å±€æ ·å¼
â””â”€â”€ components/
    â”œâ”€â”€ ui/                    # åŸºç¡€UIç»„ä»¶
    â”‚   â”œâ”€â”€ Button/
    â”‚   â”œâ”€â”€ Modal/
    â”‚   â”œâ”€â”€ Table/
    â”‚   â””â”€â”€ Chart/
    â”œâ”€â”€ features/              # åŠŸèƒ½ç»„ä»¶
    â”‚   â”œâ”€â”€ AIChat.tsx         # AIèŠå¤©ç•Œé¢
    â”‚   â”œâ”€â”€ EquityChart.tsx    # æƒç›Šå›¾è¡¨
    â”‚   â”œâ”€â”€ DecisionHistory.tsx # å†³ç­–å†å²
    â”‚   â”œâ”€â”€ AccountInfo.tsx    # è´¦æˆ·ä¿¡æ¯
    â”‚   â”œâ”€â”€ PriceTicker.tsx    # ä»·æ ¼æ»šåŠ¨æ˜¾ç¤º
    â”‚   â””â”€â”€ TradingPanel.tsx   # äº¤æ˜“é¢æ¿
    â””â”€â”€ layouts/               # å¸ƒå±€ç»„ä»¶
        â”œâ”€â”€ Header.tsx
        â”œâ”€â”€ Sidebar.tsx
        â””â”€â”€ Footer.tsx
```

#### ğŸ¨ çŠ¶æ€ç®¡ç†
```typescript
// ä½¿ç”¨React Hooks + Contextè¿›è¡ŒçŠ¶æ€ç®¡ç†
interface AppState {
  marketData: MarketState;        // å¸‚åœºæ•°æ®çŠ¶æ€
  positions: PositionState;       // ä»“ä½çŠ¶æ€
  decisions: DecisionState;       // å†³ç­–çŠ¶æ€
  account: AccountState;          // è´¦æˆ·çŠ¶æ€
  ui: UIState;                   // UIçŠ¶æ€
}

// çŠ¶æ€æ›´æ–°ä½¿ç”¨useReducer
const [state, dispatch] = useReducer(appReducer, initialState);
```

#### ğŸ”„ æ•°æ®è·å–ç­–ç•¥
```typescript
// SWRç”¨äºæ•°æ®è·å–å’Œç¼“å­˜
const useMarketData = (symbols: string[]) => {
  return useSWR(
    ['marketData', symbols.join(',')],
    () => fetchMarketData(symbols),
    {
      refreshInterval: 3000,      // 3ç§’åˆ·æ–°
      revalidateOnFocus: true,
      errorRetryCount: 3
    }
  );
};
```

### 2. APIå±‚æ¶æ„ (API Layer Architecture)

#### ğŸ›£ï¸ è·¯ç”±è®¾è®¡
```
src/app/api/
â”œâ”€â”€ ai/                          # AIç›¸å…³API
â”‚   â”œâ”€â”€ decision/route.ts        # AIå†³ç­–ç”Ÿæˆ
â”‚   â”œâ”€â”€ execute-decision/route.ts # æ‰§è¡ŒAIå†³ç­–
â”‚   â””â”€â”€ history/route.ts         # å†³ç­–å†å²
â”œâ”€â”€ orders/                      # è®¢å•ç®¡ç†API
â”‚   â”œâ”€â”€ route.ts                 # åˆ›å»ºè®¢å•
â”‚   â”œâ”€â”€ [id]/route.ts            # è®¢å•è¯¦æƒ…
â”‚   â””â”€â”€ cancel/route.ts          # å–æ¶ˆè®¢å•
â”œâ”€â”€ account/                     # è´¦æˆ·ç®¡ç†API
â”‚   â”œâ”€â”€ balance/route.ts         # è´¦æˆ·ä½™é¢
â”‚   â”œâ”€â”€ positions/route.ts       # ä»“ä½ä¿¡æ¯
â”‚   â””â”€â”€ history/route.ts         # äº¤æ˜“å†å²
â”œâ”€â”€ market/                      # å¸‚åœºæ•°æ®API
â”‚   â”œâ”€â”€ ticker/route.ts          # ä»·æ ¼æ•°æ®
â”‚   â”œâ”€â”€ kline/route.ts           # Kçº¿æ•°æ®
â”‚   â””â”€â”€ indicators/route.ts      # æŠ€æœ¯æŒ‡æ ‡
â””â”€â”€ system/                      # ç³»ç»Ÿç®¡ç†API
    â”œâ”€â”€ health/route.ts          # å¥åº·æ£€æŸ¥
    â””â”€â”€ config/route.ts          # ç³»ç»Ÿé…ç½®
```

#### ğŸ›¡ï¸ ä¸­é—´ä»¶è®¾è®¡
```typescript
// APIä¸­é—´ä»¶æ ˆ
export function withAuth(handler: Function) {
  return async (req: NextRequest) => {
    // èº«ä»½éªŒè¯
    const token = req.headers.get('Authorization');
    if (!validateToken(token)) {
      return NextResponse.json({ error: 'Unauthorized' }, { status: 401 });
    }
    return handler(req);
  };
}

export function withRateLimit(handler: Function, limit: number = 100) {
  return async (req: NextRequest) => {
    // é™æµæ§åˆ¶
    const clientId = getClientId(req);
    if (await isRateLimited(clientId, limit)) {
      return NextResponse.json({ error: 'Too Many Requests' }, { status: 429 });
    }
    return handler(req);
  };
}

export function withLogging(handler: Function) {
  return async (req: NextRequest) => {
    const start = Date.now();
    const result = await handler(req);
    const duration = Date.now() - start;

    logger.info('API Request', {
      method: req.method,
      path: req.nextUrl.pathname,
      duration,
      status: result.status
    });

    return result;
  };
}
```

### 3. ä¸šåŠ¡æœåŠ¡å±‚æ¶æ„ (Business Service Layer)

#### ğŸ¤– AIå†³ç­–æœåŠ¡
```typescript
// AIå†³ç­–å¼•æ“æ¶æ„
class AIDecisionEngine {
  private aiServices: Map<string, AIService>;
  private promptBuilder: PromptBuilder;
  private decisionValidator: DecisionValidator;

  async generateDecision(marketData: MarketData): Promise<AIDecision> {
    // 1. æ„å»ºæç¤ºè¯
    const prompt = this.promptBuilder.build(marketData);

    // 2. è°ƒç”¨AIæœåŠ¡
    const aiService = this.selectAIService();
    const response = await aiService.generateResponse(prompt);

    // 3. è§£æå†³ç­–
    const decision = this.parseDecision(response);

    // 4. éªŒè¯å†³ç­–
    await this.decisionValidator.validate(decision);

    return decision;
  }
}
```

#### ğŸ’° äº¤æ˜“æ‰§è¡ŒæœåŠ¡
```typescript
// äº¤æ˜“æ‰§è¡Œå¼•æ“
class TradingEngine {
  private okxClient: OKXClient;
  private marginCalculator: MarginCalculator;
  private riskManager: RiskManager;

  async executeDecision(decision: AIDecision): Promise<ExecutionResult> {
    try {
      // 1. é£é™©æ£€æŸ¥
      await this.riskManager.validateDecision(decision);

      // 2. ä¿è¯é‡‘è®¡ç®—
      const margin = await this.marginCalculator.calculate(decision);

      // 3. åˆ›å»ºè®¢å•
      const order = await this.createOrder(decision, margin);

      // 4. æ‰§è¡Œè®¢å•
      const result = await this.okxClient.executeOrder(order);

      // 5. è®°å½•æ‰§è¡Œç»“æœ
      await this.recordExecution(result);

      return result;
    } catch (error) {
      await this.handleExecutionError(error, decision);
      throw error;
    }
  }
}
```

#### ğŸ›¡ï¸ é£é™©æ§åˆ¶æœåŠ¡
```typescript
// é£é™©ç®¡ç†ç³»ç»Ÿ
class RiskManager {
  private positionMonitor: PositionMonitor;
  private exposureCalculator: ExposureCalculator;
  private alertManager: AlertManager;

  async validateDecision(decision: AIDecision): Promise<ValidationResult> {
    const checks = await Promise.all([
      this.checkPositionSize(decision),
      this.checkExposure(decision),
      this.checkCorrelation(decision),
      this.checkLeverage(decision)
    ]);

    const failedChecks = checks.filter(check => !check.passed);
    if (failedChecks.length > 0) {
      return {
        passed: false,
        reasons: failedChecks.map(check => check.reason)
      };
    }

    return { passed: true };
  }
}
```

### 4. æ•°æ®å±‚æ¶æ„ (Data Layer Architecture)

#### ğŸ—„ï¸ æ•°æ®åº“è®¾è®¡
```sql
-- å†³ç­–è®°å½•è¡¨
CREATE TABLE decisions (
  id INTEGER PRIMARY KEY AUTOINCREMENT,
  symbol TEXT NOT NULL,
  action TEXT NOT NULL,
  confidence INTEGER,
  size_usdt REAL,
  leverage INTEGER,
  take_profit REAL,
  stop_loss REAL,
  reasoning TEXT,
  ai_service TEXT,
  created_at DATETIME DEFAULT CURRENT_TIMESTAMP,
  executed_at DATETIME,
  status TEXT DEFAULT 'pending'
);

-- äº¤æ˜“è®°å½•è¡¨
CREATE TABLE trades (
  id INTEGER PRIMARY KEY AUTOINCREMENT,
  decision_id INTEGER,
  symbol TEXT NOT NULL,
  side TEXT NOT NULL,
  size REAL NOT NULL,
  price REAL NOT NULL,
  leverage INTEGER,
  order_id TEXT,
  fee REAL,
  pnl REAL,
  status TEXT,
  created_at DATETIME DEFAULT CURRENT_TIMESTAMP,
  closed_at DATETIME,
  FOREIGN KEY (decision_id) REFERENCES decisions(id)
);

-- å¸‚åœºæ•°æ®è¡¨
CREATE TABLE market_data (
  id INTEGER PRIMARY KEY AUTOINCREMENT,
  symbol TEXT NOT NULL,
  price REAL NOT NULL,
  volume REAL NOT NULL,
  high_24h REAL,
  low_24h REAL,
  change_24h REAL,
  timestamp DATETIME DEFAULT CURRENT_TIMESTAMP,
  INDEX idx_symbol_timestamp (symbol, timestamp)
);

-- æŠ€æœ¯æŒ‡æ ‡è¡¨
CREATE TABLE technical_indicators (
  id INTEGER PRIMARY KEY AUTOINCREMENT,
  symbol TEXT NOT NULL,
  timeframe TEXT NOT NULL,
  ema20 REAL,
  ema50 REAL,
  macd_line REAL,
  macd_signal REAL,
  rsi REAL,
  atr REAL,
  timestamp DATETIME DEFAULT CURRENT_TIMESTAMP,
  INDEX idx_symbol_timeframe (symbol, timeframe, timestamp)
);
```

#### ğŸ—ƒï¸ ç¼“å­˜ç­–ç•¥
```typescript
// Redisç¼“å­˜æ¶æ„
class CacheManager {
  private redis: Redis;

  // å¸‚åœºæ•°æ®ç¼“å­˜ (3ç§’è¿‡æœŸ)
  async getMarketData(symbol: string): Promise<MarketData | null> {
    const key = `market:${symbol}`;
    const data = await this.redis.get(key);
    return data ? JSON.parse(data) : null;
  }

  // æŠ€æœ¯æŒ‡æ ‡ç¼“å­˜ (1åˆ†é’Ÿè¿‡æœŸ)
  async getIndicators(symbol: string, timeframe: string): Promise<Indicators | null> {
    const key = `indicators:${symbol}:${timeframe}`;
    const data = await this.redis.get(key);
    return data ? JSON.parse(data) : null;
  }

  // ç”¨æˆ·ä¼šè¯ç¼“å­˜ (30åˆ†é’Ÿè¿‡æœŸ)
  async getUserSession(userId: string): Promise<Session | null> {
    const key = `session:${userId}`;
    const data = await this.redis.get(key);
    return data ? JSON.parse(data) : null;
  }
}
```

---

## ğŸ”„ ç³»ç»Ÿé›†æˆæ¶æ„

### 1. OKXäº¤æ˜“æ‰€é›†æˆ

#### ğŸ”Œ APIå®¢æˆ·ç«¯æ¶æ„
```typescript
// OKX APIå®¢æˆ·ç«¯
class OKXClient {
  private apiKey: string;
  private secret: string;
  private passphrase: string;
  private baseUrl: string;

  // è´¦æˆ·ä¿¡æ¯
  async getAccountBalance(): Promise<Balance> {
    return this.request('GET', '/api/v5/account/balance');
  }

  // ä»“ä½ä¿¡æ¯
  async getPositions(): Promise<Position[]> {
    return this.request('GET', '/api/v5/account/positions');
  }

  // åˆ›å»ºè®¢å•
  async createOrder(order: OrderRequest): Promise<OrderResponse> {
    return this.request('POST', '/api/v5/trade/order', order);
  }

  // æ’¤é”€è®¢å•
  async cancelOrder(orderId: string, symbol: string): Promise<CancelResponse> {
    return this.request('POST', '/api/v5/trade/cancel-order', {
      ordId: orderId,
      instId: symbol
    });
  }

  private async request(method: string, path: string, body?: any): Promise<any> {
    const timestamp = Date.now().toString();
    const signature = this.generateSignature(timestamp, method, path, body || '');

    const response = await fetch(`${this.baseUrl}${path}`, {
      method,
      headers: {
        'OK-ACCESS-KEY': this.apiKey,
        'OK-ACCESS-SIGN': signature,
        'OK-ACCESS-TIMESTAMP': timestamp,
        'OK-ACCESS-PASSPHRASE': this.passphrase,
        'Content-Type': 'application/json'
      },
      body: body ? JSON.stringify(body) : undefined
    });

    return this.handleResponse(response);
  }
}
```

### 2. AIæœåŠ¡é›†æˆ

#### ğŸ¤– å¤šAIæœåŠ¡æŠ½è±¡
```typescript
// AIæœåŠ¡æŠ½è±¡æ¥å£
interface AIService {
  name: string;
  generateDecision(prompt: string): Promise<AIDecision[]>;
  validateHealth(): Promise<boolean>;
}

// DeepSeekæœåŠ¡å®ç°
class DeepSeekService implements AIService {
  name = 'DeepSeek';
  private apiKey: string;
  private baseUrl: string;

  async generateDecision(prompt: string): Promise<AIDecision[]> {
    const response = await fetch(`${this.baseUrl}/chat/completions`, {
      method: 'POST',
      headers: {
        'Authorization': `Bearer ${this.apiKey}`,
        'Content-Type': 'application/json'
      },
      body: JSON.stringify({
        model: 'deepseek-chat',
        messages: [{ role: 'user', content: prompt }],
        temperature: 0.7,
        max_tokens: 2000
      })
    });

    const data = await response.json();
    return this.parseResponse(data.choices[0].message.content);
  }
}

// AIæœåŠ¡ç®¡ç†å™¨
class AIServiceManager {
  private services: Map<string, AIService> = new Map();
  private currentService: string;

  registerService(name: string, service: AIService): void {
    this.services.set(name, service);
  }

  async generateDecision(prompt: string): Promise<AIDecision[]> {
    const service = this.services.get(this.currentService);
    if (!service) {
      throw new Error(`AI service ${this.currentService} not found`);
    }

    try {
      return await service.generateDecision(prompt);
    } catch (error) {
      // æœåŠ¡å¤±è´¥æ—¶å°è¯•åˆ‡æ¢åˆ°å¤‡ç”¨æœåŠ¡
      return this.handleServiceFailure(error, prompt);
    }
  }
}
```

### 3. æ•°æ®æµé›†æˆ

#### ğŸ“Š æ•°æ®å¤„ç†ç®¡é“
```typescript
// æ•°æ®å¤„ç†ç®¡é“
class DataPipeline {
  private collectors: DataCollector[];
  private processors: DataProcessor[];
  private storage: DataStorage;

  async processData(): Promise<void> {
    // 1. æ•°æ®æ”¶é›†
    const marketData = await Promise.all(
      this.collectors.map(collector => collector.collect())
    );

    // 2. æ•°æ®å¤„ç†
    const processedData = await this.processDataStep(marketData);

    // 3. æ•°æ®å­˜å‚¨
    await this.storage.store(processedData);

    // 4. è§¦å‘åç»­å¤„ç†
    await this.triggerPostProcessing(processedData);
  }

  private async processDataStep(data: MarketData[]): Promise<ProcessedData> {
    // è®¡ç®—æŠ€æœ¯æŒ‡æ ‡
    const indicators = await this.calculateIndicators(data);

    // è®¡ç®—å¸‚åœºæƒ…ç»ª
    const sentiment = await this.calculateSentiment(data);

    // ç”Ÿæˆäº¤æ˜“ä¿¡å·
    const signals = await this.generateSignals(data, indicators);

    return {
      marketData: data,
      indicators,
      sentiment,
      signals,
      timestamp: new Date()
    };
  }
}
```

---

## ğŸ›¡ï¸ å®‰å…¨æ¶æ„

### 1. è®¤è¯ä¸æˆæƒ

#### ğŸ” JWTè®¤è¯æµç¨‹
```typescript
// JWTè®¤è¯ä¸­é—´ä»¶
class AuthMiddleware {
  private jwtSecret: string;

  async authenticate(token: string): Promise<AuthResult> {
    try {
      const payload = jwt.verify(token, this.jwtSecret) as JWTPayload;

      // éªŒè¯ç”¨æˆ·çŠ¶æ€
      const user = await this.getUserById(payload.userId);
      if (!user || user.status !== 'active') {
        return { authenticated: false, reason: 'User not found or inactive' };
      }

      // æ£€æŸ¥æƒé™
      const permissions = await this.getUserPermissions(user.id);

      return {
        authenticated: true,
        user,
        permissions
      };
    } catch (error) {
      return { authenticated: false, reason: 'Invalid token' };
    }
  }
}
```

### 2. æ•°æ®ä¿æŠ¤

#### ğŸ”’ æ•æ„Ÿæ•°æ®åŠ å¯†
```typescript
// æ•°æ®åŠ å¯†æœåŠ¡
class EncryptionService {
  private algorithm = 'aes-256-gcm';
  private key: Buffer;

  encrypt(data: string): EncryptedData {
    const iv = crypto.randomBytes(16);
    const cipher = crypto.createCipher(this.algorithm, this.key);
    cipher.setAAD(Buffer.from('additional-data'));

    let encrypted = cipher.update(data, 'utf8', 'hex');
    encrypted += cipher.final('hex');

    const authTag = cipher.getAuthTag();

    return {
      encrypted,
      iv: iv.toString('hex'),
      authTag: authTag.toString('hex')
    };
  }

  decrypt(encryptedData: EncryptedData): string {
    const decipher = crypto.createDecipher(this.algorithm, this.key);
    decipher.setAAD(Buffer.from('additional-data'));
    decipher.setAuthTag(Buffer.from(encryptedData.authTag, 'hex'));

    let decrypted = decipher.update(encryptedData.encrypted, 'hex', 'utf8');
    decrypted += decipher.final('utf8');

    return decrypted;
  }
}
```

### 3. APIå®‰å…¨

#### ğŸ›¡ï¸ è¯·æ±‚å®‰å…¨éªŒè¯
```typescript
// APIå®‰å…¨éªŒè¯
class APISecurity {
  // è¯·æ±‚ç­¾åéªŒè¯
  verifySignature(request: APIRequest): boolean {
    const { timestamp, signature, body } = request;
    const expectedSignature = this.generateSignature(timestamp, body);
    return crypto.timingSafeEqual(
      Buffer.from(signature),
      Buffer.from(expectedSignature)
    );
  }

  // è¯·æ±‚é¢‘ç‡é™åˆ¶
  async checkRateLimit(clientId: string, endpoint: string): Promise<boolean> {
    const key = `rate_limit:${clientId}:${endpoint}`;
    const current = await this.redis.incr(key);

    if (current === 1) {
      await this.redis.expire(key, 60); // 1åˆ†é’Ÿè¿‡æœŸ
    }

    const limit = this.getRateLimit(endpoint);
    return current <= limit;
  }

  // IPç™½åå•éªŒè¯
  verifyIPWhitelist(ip: string): boolean {
    const allowedIPs = process.env.ALLOWED_IPS?.split(',') || [];
    return allowedIPs.length === 0 || allowedIPs.includes(ip);
  }
}
```

---

## ğŸ“Š ç›‘æ§æ¶æ„

### 1. ç³»ç»Ÿç›‘æ§

#### ğŸ“ˆ æ€§èƒ½ç›‘æ§
```typescript
// æ€§èƒ½ç›‘æ§æœåŠ¡
class PerformanceMonitor {
  private metrics: Map<string, Metric> = new Map();

  // è®°å½•APIå“åº”æ—¶é—´
  recordAPIMetrics(endpoint: string, duration: number, status: number): void {
    const key = `api.${endpoint}`;
    this.updateMetric(key, duration, status === 200);
  }

  // è®°å½•æ•°æ®åº“æŸ¥è¯¢æ€§èƒ½
  recordQueryMetrics(query: string, duration: number): void {
    const key = `db.query.${this.hashQuery(query)}`;
    this.updateMetric(key, duration, true);
  }

  // è®°å½•äº¤æ˜“æ‰§è¡Œæ€§èƒ½
  recordTradeMetrics(symbol: string, duration: number, success: boolean): void {
    const key = `trade.${symbol}`;
    this.updateMetric(key, duration, success);
  }

  getMetricsSummary(): MetricsSummary {
    return {
      totalRequests: this.getTotalRequests(),
      averageResponseTime: this.getAverageResponseTime(),
      errorRate: this.getErrorRate(),
      successRate: this.getSuccessRate()
    };
  }
}
```

### 2. ä¸šåŠ¡ç›‘æ§

#### ğŸ’° äº¤æ˜“ç›‘æ§
```typescript
// äº¤æ˜“ç›‘æ§ç³»ç»Ÿ
class TradingMonitor {
  // å®æ—¶ç›‘æ§ä»“ä½
  async monitorPositions(): Promise<void> {
    const positions = await this.positionService.getActivePositions();

    for (const position of positions) {
      const risk = await this.assessPositionRisk(position);

      if (risk.level === 'HIGH') {
        await this.sendAlert({
          type: 'POSITION_RISK',
          symbol: position.symbol,
          message: `High risk detected for ${position.symbol} position`,
          data: position
        });
      }
    }
  }

  // ç›‘æ§äº¤æ˜“æ‰§è¡Œ
  async monitorTradeExecution(tradeId: string): Promise<void> {
    const trade = await this.tradeService.getTrade(tradeId);

    if (trade.status === 'FAILED') {
      await this.sendAlert({
        type: 'TRADE_FAILED',
        tradeId,
        message: `Trade execution failed: ${trade.error}`,
        data: trade
      });
    }
  }

  // ç›‘æ§è´¦æˆ·å¥åº·
  async monitorAccountHealth(): Promise<void> {
    const balance = await this.accountService.getBalance();
    const positions = await this.positionService.getActivePositions();

    const totalExposure = this.calculateTotalExposure(positions);
    const exposureRatio = totalExposure / balance.total;

    if (exposureRatio > 0.8) {
      await this.sendAlert({
        type: 'HIGH_EXPOSURE',
        message: `High exposure ratio: ${(exposureRatio * 100).toFixed(2)}%`,
        data: { balance, totalExposure, exposureRatio }
      });
    }
  }
}
```

---

## ğŸš€ éƒ¨ç½²æ¶æ„

### 1. å®¹å™¨åŒ–éƒ¨ç½²

#### ğŸ³ Dockeré…ç½®
```dockerfile
# Dockerfile
FROM node:18-alpine AS base

WORKDIR /app

# å®‰è£…ä¾èµ–
COPY package*.json ./
RUN npm ci --only=production

# å¤åˆ¶æºä»£ç 
COPY . .

# æ„å»ºåº”ç”¨
RUN npm run build

# ç”Ÿäº§é•œåƒ
FROM node:18-alpine AS production
WORKDIR /app

COPY --from=base /app/.next ./.next
COPY --from=base /app/node_modules ./node_modules
COPY --from=base /app/package.json ./package.json
COPY --from=base /app/public ./public

EXPOSE 3000

CMD ["npm", "start"]
```

#### ğŸ™ Docker Composeé…ç½®
```yaml
# docker-compose.yml
version: '3.8'

services:
  app:
    build: .
    ports:
      - "3000:3000"
    environment:
      - NODE_ENV=production
      - DATABASE_URL=sqlite:./data/app.db
      - REDIS_URL=redis://redis:6379
    depends_on:
      - redis
    volumes:
      - ./data:/app/data
      - ./logs:/app/logs

  redis:
    image: redis:7-alpine
    ports:
      - "6379:6379"
    volumes:
      - redis_data:/data

  nginx:
    image: nginx:alpine
    ports:
      - "80:80"
      - "443:443"
    volumes:
      - ./nginx.conf:/etc/nginx/nginx.conf
      - ./ssl:/etc/nginx/ssl
    depends_on:
      - app

volumes:
  redis_data:
```

### 2. äº‘åŸç”Ÿéƒ¨ç½²

#### â˜¸ï¸ Kubernetesé…ç½®
```yaml
# k8s-deployment.yaml
apiVersion: apps/v1
kind: Deployment
metadata:
  name: nof2ai-trading
spec:
  replicas: 3
  selector:
    matchLabels:
      app: nof2ai-trading
  template:
    metadata:
      labels:
        app: nof2ai-trading
    spec:
      containers:
      - name: app
        image: nof2ai/trading:latest
        ports:
        - containerPort: 3000
        env:
        - name: NODE_ENV
          value: "production"
        - name: DATABASE_URL
          valueFrom:
            secretKeyRef:
              name: app-secrets
              key: database-url
        - name: REDIS_URL
          value: "redis://redis-service:6379"
        resources:
          requests:
            memory: "256Mi"
            cpu: "250m"
          limits:
            memory: "512Mi"
            cpu: "500m"
        livenessProbe:
          httpGet:
            path: /api/system/health
            port: 3000
          initialDelaySeconds: 30
          periodSeconds: 10
        readinessProbe:
          httpGet:
            path: /api/system/ready
            port: 3000
          initialDelaySeconds: 5
          periodSeconds: 5
---
apiVersion: v1
kind: Service
metadata:
  name: nof2ai-trading-service
spec:
  selector:
    app: nof2ai-trading
  ports:
  - protocol: TCP
    port: 80
    targetPort: 3000
  type: ClusterIP
```

---

## ğŸ”® æ¶æ„æ¼”è¿›è§„åˆ’

### 1. å¾®æœåŠ¡æ¶æ„è¿ç§»

#### ğŸ¯ æœåŠ¡æ‹†åˆ†ç­–ç•¥
```typescript
// å¾®æœåŠ¡æ¶æ„è§„åˆ’
interface MicroserviceArchitecture {
  services: {
    userService: {
      responsibilities: ['ç”¨æˆ·ç®¡ç†', 'è®¤è¯æˆæƒ', 'æƒé™æ§åˆ¶'];
      database: 'PostgreSQL';
      cache: 'Redis';
    };

    tradingService: {
      responsibilities: ['äº¤æ˜“æ‰§è¡Œ', 'è®¢å•ç®¡ç†', 'ä»“ä½ç®¡ç†'];
      database: 'PostgreSQL';
      cache: 'Redis';
      messageQueue: 'RabbitMQ';
    };

    aiService: {
      responsibilities: ['AIå†³ç­–', 'æ¨¡å‹ç®¡ç†', 'æç¤ºè¯ç®¡ç†'];
      database: 'MongoDB';
      cache: 'Redis';
      gpu: 'Required';
    };

    marketDataService: {
      responsibilities: ['å¸‚åœºæ•°æ®', 'æŠ€æœ¯æŒ‡æ ‡', 'æ•°æ®å­˜å‚¨'];
      database: 'InfluxDB'; // æ—¶åºæ•°æ®åº“
      cache: 'Redis';
      messageQueue: 'Kafka';
    };

    riskService: {
      responsibilities: ['é£é™©æ§åˆ¶', 'ç›‘æ§å‘Šè­¦', 'åˆè§„æ£€æŸ¥'];
      database: 'PostgreSQL';
      cache: 'Redis';
      notifications: 'Email/Slack';
    };
  };
}
```

### 2. äº‹ä»¶é©±åŠ¨æ¶æ„

#### ğŸ“¨ äº‹ä»¶ç³»ç»Ÿè®¾è®¡
```typescript
// äº‹ä»¶é©±åŠ¨æ¶æ„
interface EventDrivenArchitecture {
  events: {
    DecisionGenerated: {
      payload: AIDecision;
      consumers: ['riskService', 'tradingService', 'monitoringService'];
    };

    OrderExecuted: {
      payload: TradeExecution;
      consumers: ['positionService', 'accountService', 'notificationService'];
    };

    PriceAlert: {
      payload: PriceAlert;
      consumers: ['aiService', 'riskService', 'userService'];
    };

    RiskAlert: {
      payload: RiskAlert;
      consumers: ['tradingService', 'notificationService', 'monitoringService'];
    };
  };
}
```

### 3. æ•°æ®æ¹–æ¶æ„

#### ğŸ—ƒï¸ å¤§æ•°æ®å¤„ç†æ¶æ„
```typescript
// æ•°æ®æ¹–æ¶æ„
interface DataLakeArchitecture {
  layers: {
    bronze: {
      description: 'åŸå§‹æ•°æ®å±‚';
      sources: ['OKX API', 'å¸‚åœºæ•°æ®æº', 'ç”¨æˆ·è¡Œä¸ºæ—¥å¿—'];
      format: 'JSON/CSV';
      storage: 'AWS S3';
    };

    silver: {
      description: 'æ¸…æ´—å¤„ç†å±‚';
      processing: ['æ•°æ®æ¸…æ´—', 'æ ¼å¼è½¬æ¢', 'è´¨é‡æ£€æŸ¥'];
      format: 'Parquet';
      storage: 'AWS S3';
    };

    gold: {
      description: 'ä¸šåŠ¡æ•°æ®å±‚';
      processing: ['èšåˆè®¡ç®—', 'æŒ‡æ ‡è®¡ç®—', 'ç‰¹å¾å·¥ç¨‹'];
      format: 'Delta Lake';
      storage: 'AWS S3';
    };
  };
}
```

---

## ğŸ“ æ¶æ„æ–‡æ¡£ç»´æŠ¤

### ğŸ”„ ç‰ˆæœ¬ç®¡ç†
- **æ¶æ„ç‰ˆæœ¬**ï¼šv2.0
- **æœ€åæ›´æ–°**ï¼š2025å¹´11æœˆ4æ—¥
- **ä¸‹æ¬¡å®¡æŸ¥**ï¼š2025å¹´12æœˆ4æ—¥
- **ç»´æŠ¤è€…**ï¼šæ¶æ„å›¢é˜Ÿ

### ğŸ“Š æ¶æ„å†³ç­–è®°å½• (ADR)

#### ADR-001: é€‰æ‹©Next.jsä½œä¸ºå‰ç«¯æ¡†æ¶
**çŠ¶æ€**ï¼šå·²æ¥å—
**å†³ç­–**ï¼šä½¿ç”¨Next.js 16 (App Router)
**åŸå› **ï¼šSEOå‹å¥½ã€æ€§èƒ½ä¼˜ç§€ã€ç”Ÿæ€å®Œå–„
**åæœ**ï¼šå­¦ä¹ æˆæœ¬ã€æ¡†æ¶é”å®š

#### ADR-002: é€‰æ‹©SQLiteä½œä¸ºä¸»æ•°æ®åº“
**çŠ¶æ€**ï¼šå·²æ¥å—
**å†³ç­–**ï¼šä½¿ç”¨SQLiteä½œä¸ºä¸»æ•°æ®åº“
**åŸå› **ï¼šè½»é‡çº§ã€é›¶é…ç½®ã€é€‚åˆä¸­å°è§„æ¨¡
**åæœ**ï¼šæ‰©å±•æ€§é™åˆ¶ã€å¹¶å‘é™åˆ¶

#### ADR-003: é€‰æ‹©OKXä½œä¸ºäº¤æ˜“æ‰€
**çŠ¶æ€**ï¼šå·²æ¥å—
**å†³ç­–**ï¼šé›†æˆOKX V5 API
**åŸå› **ï¼šAPIç¨³å®šã€æ–‡æ¡£å®Œå–„ã€æ”¯æŒæ°¸ç»­åˆçº¦
**åæœ**ï¼šä¾›åº”å•†é”å®šã€APIé™åˆ¶

---

*æœ¬æ¶æ„æ–‡æ¡£å°†éšç€ç³»ç»Ÿçš„å‘å±•æŒç»­æ›´æ–°ï¼Œç¡®ä¿æ¶æ„è®¾è®¡ä¸å®é™…å®ç°ä¿æŒä¸€è‡´ã€‚*