# ğŸ¯ ç™¾åˆ†æ¯”ä»“ä½ç³»ç»Ÿ - æœ€ç»ˆè§£å†³æ–¹æ¡ˆ

## é—®é¢˜èƒŒæ™¯

ç”¨æˆ·æŠ¥å‘Šï¼š
```
æ€»èµ„é‡‘åªæœ‰$10ï¼Œä½†AIè¦æ±‚å¼€ä»“$700
æ‰§è¡Œå¤±è´¥ï¼šåˆçº¦å¼ æ•°ä¸è¶³
```

**æ ¹æœ¬åŸå› **ï¼š
- AIä¸çŸ¥é“å®é™…å¯ç”¨èµ„é‡‘
- AIç»™å‡ºçš„å›ºå®šUSDTé‡‘é¢ä¸åˆç†
- å½“å¯ç”¨èµ„é‡‘å˜åŒ–æ—¶ï¼ŒAIçš„å†³ç­–æ— æ³•è‡ªé€‚åº”

---

## è§£å†³æ–¹æ¡ˆï¼šç™¾åˆ†æ¯”ä»“ä½ç³»ç»Ÿ

### æ ¸å¿ƒæ€è·¯

**ä¸è®©AIæŒ‡å®šç»å¯¹é‡‘é¢ï¼Œè€Œæ˜¯è®©AIæŒ‡å®šä»“ä½ç™¾åˆ†æ¯”ï¼**

```
AIè¯´ï¼šç”¨30%èµ„é‡‘å¼€ä»“
å¯ç”¨èµ„é‡‘ $10  â†’ ç³»ç»Ÿè®¡ç®—ï¼š$3
å¯ç”¨èµ„é‡‘ $100 â†’ ç³»ç»Ÿè®¡ç®—ï¼š$30
å¯ç”¨èµ„é‡‘ $1000 â†’ ç³»ç»Ÿè®¡ç®—ï¼š$300
```

è¿™æ ·AIçš„å†³ç­–å¯ä»¥è‡ªåŠ¨é€‚é…ä»»ä½•èµ„é‡‘è§„æ¨¡ï¼

---

## å®ç°ç»†èŠ‚

### 1. AIå†³ç­–æ ¼å¼ï¼ˆæ–°ï¼‰

```json
{
  "symbol": "BTC",
  "action": "OPEN_LONG",
  "confidence": 75,
  "position_size_percent": 25,  // âœ… ç”¨25%å¯ç”¨èµ„é‡‘
  "take_profit": 112000,
  "stop_loss": 108500,
  "leverage": 5,
  "reasoning": "å¼ºåŠ¿å¤šå¤´ä¿¡å·"
}
```

**position_size_percentè§„åˆ™**ï¼š
- èŒƒå›´ï¼š5-50ï¼ˆä»£è¡¨5%-50%ï¼‰
- é«˜ç½®ä¿¡åº¦(>80%)ï¼š30-40%
- ä¸­ç­‰ç½®ä¿¡åº¦(70-80%)ï¼š20-30%
- è¾ƒä½ç½®ä¿¡åº¦(65-70%)ï¼š10-20%

### 2. åç«¯è‡ªåŠ¨è½¬æ¢

```typescript
// src/app/api/ai/execute-decision/route.ts

// è·å–AIæŒ‡å®šçš„ç™¾åˆ†æ¯”
const positionPercent = decision.positionSizePercent;  // ä¾‹å¦‚ï¼š25

// è·å–å®æ—¶å¯ç”¨èµ„é‡‘
const availableCash = await fetchAvailableUSDT();  // ä¾‹å¦‚ï¼š$10

// è®¡ç®—å®é™…USDTé‡‘é¢
const requestedUSDT = availableCash * (positionPercent / 100);
// = $10 Ã— 25% = $2.5

// è¿›å…¥ä¿è¯é‡‘è®¡ç®—å™¨
const marginCalc = calculateMarginRequirement(
  symbol,
  entryPrice,
  requestedUSDT,  // $2.5ä½œä¸ºä¿è¯é‡‘
  leverage        // 5x
);
// åä¹‰ä»·å€¼ = $2.5 Ã— 5 = $12.5
// åˆçº¦å¼ æ•° = $12.5 / $107000 = 0.000117å¼ 
```

### 3. æœ€å°é‡‘é¢æ£€æŸ¥

```typescript
const MIN_ORDER_USDT = 5;  // æœ€å°5u

if (requestedUSDT < MIN_ORDER_USDT) {
  return {
    error: `è®¢å•é‡‘é¢è¿‡å°ï¼š$${requestedUSDT} < $5æœ€ä½è¦æ±‚`
  };
}
```

è¿™æ ·å¦‚æœå¯ç”¨èµ„é‡‘åªæœ‰$10ï¼Œç”¨30%ä¹Ÿåªæœ‰$3ï¼Œä¼šè¢«æ‹’ç»ã€‚

---

## AIæç¤ºè¯æ›´æ–°

### æ–°çš„ä»“ä½æŒ‡å—

```
POSITION SIZING GUIDELINES (position_size_percent):
âš ï¸ CRITICAL: Use PERCENTAGE of available cash, NOT absolute USDT amounts!

PERCENTAGE-BASED SIZING:
  * High Confidence (>80%): 30-40% of available cash
  * Medium Confidence (70-80%): 20-30% of available cash
  * Lower Confidence (65-70%): 10-20% of available cash
  * Weak signals (<65%): DO NOT OPEN, choose HOLD

EXAMPLES:
- Available Cash = $10, position_size_percent = 30 â†’ System uses $3
- Available Cash = $100, position_size_percent = 25 â†’ System uses $25
- Available Cash = $1000, position_size_percent = 40 â†’ System uses $400
```

### åˆ é™¤çš„æ—§æŒ‡å—

```
âŒ åˆ é™¤ï¼š
  * BTC (5-10x leverage): 300-1000 USDT
  * ETH (5-10x leverage): 200-800 USDT
è¿™äº›å›ºå®šé‡‘é¢ä¸é€‚ç”¨äºæ‰€æœ‰èµ„é‡‘è§„æ¨¡
```

---

## ä¼˜åŠ¿

### 1. è‡ªåŠ¨é€‚é…èµ„é‡‘è§„æ¨¡
```
å¯ç”¨èµ„é‡‘ $10:
  - AIè¯´30% â†’ ä½¿ç”¨$3 âœ…
  - AIè¯´50% â†’ ä½¿ç”¨$5 âœ…
  
å¯ç”¨èµ„é‡‘ $10,000:
  - AIè¯´30% â†’ ä½¿ç”¨$3,000 âœ…
  - AIè¯´50% â†’ ä½¿ç”¨$5,000 âœ…
```

### 2. é£é™©æ§åˆ¶æ›´ç²¾ç¡®
```
æ€»ä»“ä½æ§åˆ¶ï¼š
  - å·²å¼€ä»“ï¼šBTC 30% + ETH 25% = 55%
  - å¯å†å¼€ï¼š80% - 55% = 25%å‰©ä½™ç©ºé—´
  - AIå¯ä»¥å†å¼€ä¸€ä¸ª20%çš„ä»“ä½ âœ…
```

### 3. é¿å…èµ„é‡‘ä¸è¶³é”™è¯¯
```
ä¹‹å‰ï¼šAIè¯´å¼€$700ï¼Œä½†åªæœ‰$10 â†’ âŒ å¤±è´¥
ç°åœ¨ï¼šAIè¯´å¼€30%ï¼Œç³»ç»Ÿç®—å‡º$3 â†’ âœ… å¯ä»¥å¼€ï¼ˆå¦‚æœ>=$5ï¼‰
```

### 4. AIå†³ç­–æ›´æ™ºèƒ½
```
AIæ€è€ƒè¿‡ç¨‹ï¼š
"å¯ç”¨èµ„é‡‘å……è¶³ï¼Œæˆ‘æœ‰é«˜ä¿¡å¿ƒ(85%)ï¼Œä½¿ç”¨40%å¼€ä»“"
"å¯ç”¨èµ„é‡‘è¾ƒå°‘ï¼Œæˆ‘ä¸­ç­‰ä¿¡å¿ƒ(72%)ï¼Œä¿å®ˆä½¿ç”¨20%"
"å¸‚åœºä¸ç¡®å®šï¼Œåªç”¨10%è¯•æ¢"
```

---

## å‘åå…¼å®¹

ä»£ç åŒæ—¶æ”¯æŒæ–°æ—§ä¸¤ç§æ ¼å¼ï¼š

```typescript
// æ–°æ ¼å¼ï¼ˆä¼˜å…ˆï¼‰
if (decision.positionSizePercent) {
  requestedUSDT = availableCash * (positionSizePercent / 100);
}
// æ—§æ ¼å¼ï¼ˆå…¼å®¹ï¼‰
else if (decision.sizeUSDT) {
  requestedUSDT = decision.sizeUSDT;
}
```

---

## æµ‹è¯•æ¡ˆä¾‹

### æ¡ˆä¾‹1ï¼šå°èµ„é‡‘è´¦æˆ·
```
å¯ç”¨èµ„é‡‘: $10
AIå†³ç­–: position_size_percent = 30
è®¡ç®—: $10 Ã— 30% = $3
ç»“æœ: âŒ æ‹’ç»ï¼ˆ< $5æœ€ä½è¦æ±‚ï¼‰
æç¤º: "è®¢å•é‡‘é¢è¿‡å°ï¼Œå»ºè®®ç­‰å¾…èµ„é‡‘å……è¶³"
```

### æ¡ˆä¾‹2ï¼šä¸­ç­‰èµ„é‡‘è´¦æˆ·
```
å¯ç”¨èµ„é‡‘: $100
AIå†³ç­–: position_size_percent = 25
è®¡ç®—: $100 Ã— 25% = $25
æ æ†: 5x
åä¹‰ä»·å€¼: $25 Ã— 5 = $125
BTCä»·æ ¼: $107,000
åˆçº¦å¼ æ•°: $125 / $107,000 = 0.00117å¼ 
ç»“æœ: âœ… æˆåŠŸå¼€ä»“
```

### æ¡ˆä¾‹3ï¼šå¤§èµ„é‡‘è´¦æˆ·
```
å¯ç”¨èµ„é‡‘: $10,000
AIå†³ç­–: position_size_percent = 35
è®¡ç®—: $10,000 Ã— 35% = $3,500
æ æ†: 5x
åä¹‰ä»·å€¼: $3,500 Ã— 5 = $17,500
åˆçº¦å¼ æ•°: $17,500 / $107,000 = 0.1636å¼ 
ç»“æœ: âœ… æˆåŠŸå¼€ä»“
```

---

## ä¿®æ”¹çš„æ–‡ä»¶

1. **src/lib/ai-trading-prompt.ts**
   - æ›´æ–°å†³ç­–æ ¼å¼ï¼ˆposition_size_percentï¼‰
   - æ›´æ–°ä»“ä½æŒ‡å—
   - æ·»åŠ ç™¾åˆ†æ¯”ç¤ºä¾‹

2. **src/app/api/ai/execute-decision/route.ts**
   - æ·»åŠ ç™¾åˆ†æ¯”è½¬USDTé€»è¾‘
   - æ·»åŠ æœ€å°é‡‘é¢æ£€æŸ¥
   - å‘åå…¼å®¹size_usdt

3. **src/lib/trade-reflection.ts**
   - ä¿å­˜å®é™…ä½¿ç”¨çš„USDTé‡‘é¢
   - å…¼å®¹ç™¾åˆ†æ¯”æ ¼å¼

---

## ä½¿ç”¨ç¤ºä¾‹

### AIå†³ç­–ï¼ˆæ–°æ ¼å¼ï¼‰
```json
{
  "symbol": "BTC",
  "action": "OPEN_LONG",
  "confidence": 82,
  "position_size_percent": 35,
  "leverage": 5,
  "take_profit": 110000,
  "stop_loss": 106500,
  "reasoning": "å¤šç­–ç•¥èåˆä¿¡å·å¼ºåŠ¿çœ‹å¤š"
}
```

### ç³»ç»Ÿå¤„ç†
```
1. è¯»å–ï¼šposition_size_percent = 35
2. è·å–ï¼šavailableCash = $10 (å®æ—¶)
3. è®¡ç®—ï¼šrequestedUSDT = $10 Ã— 35% = $3.5
4. æ£€æŸ¥ï¼š$3.5 < $5 æœ€ä½è¦æ±‚
5. æ‹’ç»ï¼šæç¤ºèµ„é‡‘ä¸è¶³
```

å¦‚æœå¯ç”¨èµ„é‡‘æ˜¯$100ï¼š
```
3. è®¡ç®—ï¼šrequestedUSDT = $100 Ã— 35% = $35
4. æ£€æŸ¥ï¼š$35 >= $5 âœ…
5. æ‰§è¡Œï¼šå¼€ä»“æˆåŠŸ
```

---

## çŠ¶æ€

âœ… å·²å®Œå…¨é‡æ„
âœ… å‘åå…¼å®¹
âœ… æ— linteré”™è¯¯
âš ï¸ éœ€è¦é‡å¯æœåŠ¡å™¨ç”Ÿæ•ˆ

---

## æ—¥æœŸ

2025-11-03

