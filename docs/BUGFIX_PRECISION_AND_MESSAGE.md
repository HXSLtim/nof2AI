# ğŸ”§ ç²¾åº¦é”™è¯¯å’Œæ¶ˆæ¯è­¦å‘Šä¿®å¤

## é—®é¢˜æè¿°

### é—®é¢˜ 1: Ant Design Message è­¦å‘Š
```
Warning: [antd: message] Static function can not consume context like dynamic theme. 
Please use 'App' component instead.
```

**åŸå› **ï¼šä½¿ç”¨äº† `message` é™æ€æ–¹æ³•ï¼Œæ— æ³•æ¶ˆè´¹ React Contextï¼ˆå¦‚åŠ¨æ€ä¸»é¢˜ï¼‰

### é—®é¢˜ 2: SOL å¹³ä»“ç²¾åº¦é”™è¯¯
```
[Positions] å¹³ä»“ SOL å¤±è´¥: "okx amount of SOL/USDT:USDT must be greater than 
minimum amount precision of 0.01"
```

**åŸå› **ï¼šä»“ä½åˆçº¦æ•°é‡å°äº OKX è¦æ±‚çš„æœ€å°ç²¾åº¦ 0.01 å¼ 

---

## è§£å†³æ–¹æ¡ˆ

### ä¿®å¤ 1: ä½¿ç”¨ App.useApp() Hook

**ä¿®æ”¹æ–‡ä»¶**ï¼š`src/app/components/Positions.tsx`

```typescript
// âŒ æ—§ä»£ç  - é™æ€æ–¹æ³•
import { message } from 'antd';

export default function Positions() {
  // ç›´æ¥ä½¿ç”¨é™æ€æ–¹æ³•
  message.warning('å½“å‰æ²¡æœ‰ä»“ä½');
}

// âœ… æ–°ä»£ç  - ä½¿ç”¨ Hook
import { App } from 'antd';

export default function Positions() {
  const { message } = App.useApp();  // ğŸ”§ è·å– message å®ä¾‹
  
  // ä½¿ç”¨å®ä¾‹æ–¹æ³•
  message.warning('å½“å‰æ²¡æœ‰ä»“ä½');
}
```

**ä¼˜åŠ¿**ï¼š
- âœ… æ”¯æŒåŠ¨æ€ä¸»é¢˜
- âœ… æ­£ç¡®æ¶ˆè´¹ React Context
- âœ… ç¬¦åˆ Ant Design 5.x æœ€ä½³å®è·µ

---

### ä¿®å¤ 2: æ·»åŠ ç²¾åº¦æ£€æŸ¥å’Œå‹å¥½æç¤º

#### 2.1 åœ¨ `placeOrder` å‡½æ•°ä¸­æ£€æŸ¥ï¼ˆsrc/lib/okx.tsï¼‰

```typescript
export async function placeOrder(...) {
  // è®¡ç®—åˆçº¦æ•°é‡
  const rawCcxtAmount = amount * multiplier;
  const ccxtAmount = Math.floor(rawCcxtAmount);
  
  // âš ï¸ æ£€æŸ¥æœ€å°ç²¾åº¦ï¼šå¦‚æœåˆçº¦æ•°é‡ < 0.01ï¼ŒæŠ›å‡ºé”™è¯¯
  if (ccxtAmount < 0.01) {
    const errorMsg = `åˆçº¦æ•°é‡ä¸è¶³æœ€å°ç²¾åº¦è¦æ±‚ (${ccxtAmount.toFixed(8)} < 0.01)ã€‚å»ºè®®ï¼š${
      reduceOnly 
        ? 'è¯¥ä»“ä½è¿‡å°ï¼Œè¯·åœ¨OKXæ‰‹åŠ¨å¹³ä»“æˆ–ç­‰å¾…è‡ªç„¶å¹³ä»“'
        : 'è¯·å¢åŠ å¼€ä»“é‡‘é¢è‡³å°‘èƒ½ä¹°0.01å¼ åˆçº¦'
    }`;
    console.error(`[placeOrder] âŒ ${errorMsg}`);
    throw new Error(errorMsg);
  }
  
  // ç»§ç»­ä¸‹å•...
}
```

#### 2.2 åœ¨å¹³ä»“æ¥å£ä¸­æå‰æ£€æŸ¥ï¼ˆsrc/app/api/ai/execute-decision/route.tsï¼‰

```typescript
// æŸ¥æ‰¾ç›®æ ‡ä»“ä½
const targetPosition = currentPositions.find(p => 
  p.coin === decision.symbol && 
  ((decision.action === 'CLOSE_LONG' && p.side === 'long') ||
   (decision.action === 'CLOSE_SHORT' && p.side === 'short'))
);

if (!targetPosition) {
  return NextResponse.json({ 
    success: false, 
    error: `æ— æ³•å¹³ä»“ï¼šè´¦æˆ·ä¸­æ²¡æœ‰è¯¥ä»“ä½`
  }, { status: 400 });
}

// âš ï¸ æ£€æŸ¥ä»“ä½å¤§å°æ˜¯å¦æ»¡è¶³æœ€å°ç²¾åº¦è¦æ±‚
const actualQuantity = Math.abs(Number(targetPosition.contracts || 0));
if (actualQuantity < 0.01) {
  console.warn(`[execute-decision] âš ï¸ ä»“ä½è¿‡å°ï¼ˆ${actualQuantity.toFixed(8)}å¼  < 0.01ï¼‰`);
  return NextResponse.json({ 
    success: false, 
    error: `è¯¥${decision.symbol}ä»“ä½è¿‡å°ï¼ˆ${actualQuantity.toFixed(8)}å¼ ï¼‰ï¼Œä¸æ»¡è¶³OKXæœ€å°äº¤æ˜“ç²¾åº¦ï¼ˆ0.01å¼ ï¼‰ã€‚
            è¯·åœ¨OKXç½‘é¡µæˆ–APPä¸Šæ‰‹åŠ¨å¹³ä»“ï¼Œæˆ–ç­‰å¾…æ­¢ç›ˆæ­¢æŸè‡ªåŠ¨å¹³ä»“ã€‚` 
  }, { status: 400 });
}

// ç»§ç»­å¹³ä»“...
```

---

## OKX ç²¾åº¦è¦æ±‚è¯´æ˜

### åˆçº¦æœ€å°äº¤æ˜“å•ä½

| å¸ç§ | Lot Size | æœ€å°ç²¾åº¦ | ç¤ºä¾‹ |
|------|----------|---------|------|
| BTC | 1å¼  | 0.01 | 0.01å¼  â‰ˆ $0.01 BTC |
| ETH | 1å¼  | 0.01 | 0.01å¼  â‰ˆ $0.01 ETH |
| SOL | 1å¼  | 0.01 | 0.01å¼  â‰ˆ $0.01 SOL |
| å…¶ä»– | 1å¼  | 0.01 | 0.01å¼  |

**å…³é”®è§„åˆ™**ï¼š
- âœ… æ‰€æœ‰ USDT æ°¸ç»­åˆçº¦çš„ lot size = 1
- âœ… åˆçº¦æ•°é‡å¿…é¡» >= 0.01 å¼ 
- âœ… åˆçº¦æ•°é‡ä¼šå‘ä¸‹å–æ•´åˆ°æ•´æ•°å¼ 

### ä¸ºä»€ä¹ˆä¼šå‡ºç°å°äº 0.01 çš„ä»“ä½ï¼Ÿ

1. **æ­¢ç›ˆæ­¢æŸéƒ¨åˆ†æˆäº¤** - å¤§ä»“ä½è¢«éƒ¨åˆ†å¹³ä»“ï¼Œå‰©ä½™å¾ˆå°
2. **èµ„é‡‘è´¹ç”¨æ‰£é™¤** - é•¿æœŸæŒä»“è¢«æ‰£é™¤èµ„é‡‘è´¹ç”¨
3. **ä»·æ ¼æ³¢åŠ¨** - æç«¯è¡Œæƒ…å¯¼è‡´ä»“ä½å˜åŒ–
4. **æ‰‹åŠ¨è°ƒæ•´** - åœ¨ç½‘é¡µç«¯æ‰‹åŠ¨å‡ä»“

### å¤„ç†å°ä»“ä½çš„æ–¹æ³•

#### æ–¹æ³• 1: OKX ç½‘é¡µæ‰‹åŠ¨å¹³ä»“
1. ç™»å½• OKX ç½‘é¡µ https://www.okx.com
2. è¿›å…¥"äº¤æ˜“" â†’ "åˆçº¦äº¤æ˜“"
3. åœ¨æŒä»“åˆ—è¡¨æ‰¾åˆ°å°ä»“ä½
4. ç‚¹å‡»"å¹³ä»“"ï¼Œç½‘é¡µç«¯å¯ä»¥å¹³ä»»æ„å¤§å°çš„ä»“ä½

#### æ–¹æ³• 2: ç­‰å¾…è‡ªç„¶å¹³ä»“
- å¦‚æœè®¾ç½®äº†æ­¢ç›ˆæ­¢æŸï¼Œç­‰å¾…è§¦å‘è‡ªåŠ¨å¹³ä»“
- å¦‚æœä»·æ ¼åˆ°è¾¾å¼ºå¹³ä»·ï¼Œä¼šè¢«å¼ºåˆ¶å¹³ä»“

#### æ–¹æ³• 3: API å¢å¼ºï¼ˆæœªæ¥æ”¹è¿›ï¼‰
```typescript
// æœªæ¥å¯ä»¥è€ƒè™‘ä½¿ç”¨ OKX çš„ç‰¹æ®Š API
// å…è®¸å¹³æ‰å°äºæœ€å°ç²¾åº¦çš„ä»“ä½
// ç›®å‰æš‚ä¸æ”¯æŒ
```

---

## æµ‹è¯•éªŒè¯

### æµ‹è¯•åœºæ™¯ 1: æ­£å¸¸ä»“ä½å¹³ä»“
```bash
# ä»“ä½ï¼šBTC 0.5 å¼ 
# ç»“æœï¼šâœ… å¹³ä»“æˆåŠŸ
```

### æµ‹è¯•åœºæ™¯ 2: å°ä»“ä½å¹³ä»“
```bash
# ä»“ä½ï¼šSOL 0.005 å¼  (< 0.01)
# ç»“æœï¼šâŒ å‹å¥½é”™è¯¯æç¤º
# æ¶ˆæ¯ï¼šè¯¥SOLä»“ä½è¿‡å°ï¼ˆ0.00500000å¼ ï¼‰ï¼Œä¸æ»¡è¶³OKXæœ€å°äº¤æ˜“ç²¾åº¦ï¼ˆ0.01å¼ ï¼‰ã€‚
#       è¯·åœ¨OKXç½‘é¡µæˆ–APPä¸Šæ‰‹åŠ¨å¹³ä»“ï¼Œæˆ–ç­‰å¾…æ­¢ç›ˆæ­¢æŸè‡ªåŠ¨å¹³ä»“ã€‚
```

### æµ‹è¯•åœºæ™¯ 3: ä¸€é”®å¹³ä»“ï¼ˆæ··åˆï¼‰
```bash
# ä»“ä½ï¼šBTC 0.5å¼  + SOL 0.005å¼ 
# ç»“æœï¼š
#   - BTCï¼šâœ… å¹³ä»“æˆåŠŸ
#   - SOLï¼šâŒ è·³è¿‡ï¼ˆæ˜¾ç¤ºé”™è¯¯ï¼‰
# æ¶ˆæ¯ï¼šæˆåŠŸå¹³ä»“ 1 ä¸ªä»“ä½ï¼Œ1 ä¸ªä»“ä½å¤±è´¥
```

---

## å½±å“èŒƒå›´

### ä¿®æ”¹çš„æ–‡ä»¶
1. `src/app/components/Positions.tsx` - ä¿®å¤ message è­¦å‘Š
2. `src/lib/okx.ts` - æ·»åŠ ç²¾åº¦æ£€æŸ¥
3. `src/app/api/ai/execute-decision/route.ts` - æå‰éªŒè¯ä»“ä½å¤§å°

### å‘åå…¼å®¹æ€§
- âœ… å®Œå…¨å‘åå…¼å®¹
- âœ… ä¸å½±å“æ­£å¸¸å¤§å°çš„ä»“ä½
- âœ… åªå¯¹å°ä»“ä½å¢åŠ äº†å‹å¥½æç¤º

### ç”¨æˆ·ä½“éªŒæå‡
- âœ… æ˜ç¡®çš„é”™è¯¯æç¤º
- âœ… æ¸…æ™°çš„è§£å†³æ–¹æ¡ˆæŒ‡å¼•
- âœ… é¿å…æ— æ„ä¹‰çš„ API è°ƒç”¨

---

## æœ€ä½³å®è·µå»ºè®®

### å¼€ä»“æ—¶
1. âœ… ç¡®ä¿å¼€ä»“é‡‘é¢è¶³å¤Ÿå¤§ï¼ˆè‡³å°‘èƒ½ä¹° 0.01 å¼ åˆçº¦ï¼‰
2. âœ… æ ¹æ®å¸ç§ä»·æ ¼è®¡ç®—åˆç†çš„ä»“ä½å¤§å°
3. âœ… ä½¿ç”¨ç³»ç»Ÿæ¨èçš„ä»“ä½é‡‘é¢ï¼ˆ300-1000 USDTï¼‰

### å¹³ä»“æ—¶
1. âœ… ä¼˜å…ˆä½¿ç”¨æ­¢ç›ˆæ­¢æŸè‡ªåŠ¨å¹³ä»“
2. âœ… å¯¹äºå°ä»“ä½ï¼Œåœ¨ OKX ç½‘é¡µæ‰‹åŠ¨å¹³ä»“
3. âœ… é¿å…é¢‘ç¹è°ƒæ•´ä»“ä½å¯¼è‡´å‰©ä½™è¿‡å°

### é£é™©æ§åˆ¶
1. âœ… è®¾ç½®åˆç†çš„æ­¢ç›ˆæ­¢æŸä»·æ ¼
2. âœ… é¿å…ä»“ä½è¢«éƒ¨åˆ†å¹³ä»“åå‰©ä½™è¿‡å°
3. âœ… å®šæœŸæ£€æŸ¥å¹¶æ¸…ç†å°é¢ä»“ä½

---

## ç›¸å…³é“¾æ¥

- [OKX API æ–‡æ¡£ - äº¤æ˜“ç²¾åº¦](https://www.okx.com/docs-v5/zh/#order-book-trading-swap-trading)
- [Ant Design 5.x - App ç»„ä»¶](https://ant.design/components/app-cn)
- [é¡¹ç›®æ–‡æ¡£ - OKX é…ç½®](../OKX_CONFIG.md)

---

## æ€»ç»“

é€šè¿‡è¿™æ¬¡ä¿®å¤ï¼š
1. âœ… æ¶ˆé™¤äº† Ant Design çš„è­¦å‘Š
2. âœ… ä¼˜é›…å¤„ç†äº†å°ä»“ä½å¹³ä»“é—®é¢˜
3. âœ… æä¾›äº†æ¸…æ™°çš„ç”¨æˆ·æŒ‡å¼•
4. âœ… æå‡äº†ç³»ç»Ÿçš„ç¨³å®šæ€§å’Œç”¨æˆ·ä½“éªŒ

æ‰€æœ‰ä¿®æ”¹å·²æµ‹è¯•é€šè¿‡ï¼Œå¯ä»¥æ­£å¸¸ä½¿ç”¨ï¼ğŸ‰

